# Session 2026-02-10 — PDF Project
## Context snapshot (1–3 bullets)
- Multi-module Spring Boot backend with separate React frontend (`pdf-frontend`).
- Docker infra uses `docker-compose-infra.yml`; app run via `docker-compose-dev.yml` or local Maven.
- Frontend and backend now wired to shared auth + document endpoints.

## Problems encountered
- Docker dev container was slow and failed to resolve local module dependencies.
- CORS blocked frontend login requests from `http://localhost:5137` to `http://localhost:8080`.
- JWT errors due to frontend reading the wrong token field name.
- PDF preview in iframe failed due to missing auth header and `X-Frame-Options: DENY`.

## Decisions made
- Decision: Use a fast JAR-based `docker-compose-dev.yml` (no hot reload).
    - Why: Maven-in-container workflow was slow and brittle.
    - Alternatives: Containerized Maven + DevTools, local app with infra only.
    - Consequences: Rebuild JAR needed for changes; no live reload.
    - Status: Adopted
- Decision: Add backend stub endpoints to match frontend API surface.
    - Why: Prevent frontend breakage while backend features are incomplete.
    - Alternatives: Hide UI features, mock client responses.
    - Consequences: Stubs must be replaced with real implementations.
    - Status: Adopted
- Decision: Allow iframe PDF preview by accepting JWT via query param and disabling frame options (dev).
    - Why: Frontend uses iframe for preview and can’t send auth headers.
    - Alternatives: Fetch blob with auth header and render without iframe; `SAMEORIGIN` + CSP.
    - Consequences: Security loosening; should be tightened for prod.
    - Status: Adopted

## Progress & changes
- Added Spring profiles in `pdf-inbound-api` and moved config to YAML.
- Simplified `docker-compose-dev.yml` to run the packaged JAR.
- Added CORS configuration in Spring Security for local frontend origins.
- Fixed frontend auth token handling to use `jwtToken`.
- Added confirmPassword to registration request payload.
- Added backend stub endpoints for search/favourites/camera upload.
- Implemented minimal search endpoint to list user documents.

## What’s next (prioritized)
1. Implement real favourites (model + persistence + endpoints).
2. Replace iframe token-in-URL flow with authenticated blob fetch and viewer.
3. Tighten CORS and frame options for prod profiles.

## Open questions / risks
- Security risk from `X-Frame-Options` disabled and JWT in URL for previews.
- Search results are minimal (title/filename only) and may diverge from future search design.
- Favourites endpoint still returns empty data.

## Useful snippets (commands/configs/short excerpts)
- Run dev app container:
  - `mvn -pl pdf-inbound-api -am -DskipTests package`
  - `docker compose -f docker-compose-dev.yml up --build`
- Start infra:
  - `docker compose -f docker-compose-infra.yml up -d`
