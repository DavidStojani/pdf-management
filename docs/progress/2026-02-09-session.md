# Session 2026-02-09 — PDF Project
## Context snapshot (1–3 bullets)
- Worked in multi-module Spring Boot repo; focus on controller tests in `pdf-inbound-api` and profile setup discussion.
- Current runtime config lives in `pdf-inbound-api/src/main/resources/application.properties`; tests use `application-test.yml` (inbound) and `application-test.properties` (outbound-database).

## Problems encountered
- `@WebMvcTest` contexts failed due to bean collisions from broad `@ComponentScan` (`PdfApiApplication`), causing `NoUniqueBeanDefinitionException` for `AuthenticationService` and `DocumentService`.
- Mockito inline mock maker issues and ApplicationContext failure threshold made test debugging noisy.
- Auth controller tests failed due to missing `@RequestParam("token")` parameter name and missing exception mapping in the test slice (causing unhandled runtime exceptions).

## Decisions made
- Decision: None

## Progress & changes
- Investigated controller test failures; identified root causes (bean collisions, missing parameter names, missing exception handler).
- Implemented partial fixes before a pivot:
  - Added `@RequestParam("token")` to `AuthController.verifyEmail` to avoid reflection parameter-name issue.
  - Added `GlobalExceptionHandler` to `@ContextConfiguration` for controller tests so runtime exceptions map to HTTP error responses.
- Temporarily refactored `DocumentControllerTest` to focus on `/download` only, then restored it on request.
- Began planning dev/test Spring profiles; identified relevant modules and existing test configs.

## What’s next (prioritized)
1. Decide scope for Spring profiles: what belongs in `application.properties` vs `application-dev.properties` and `application-test.properties` (in `pdf-inbound-api`).
2. Re-run controller tests (`AuthControllerTest`, `DocumentControllerTest`) to confirm fixes once scope is set.
3. Standardize test profile usage (`@ActiveProfiles("test")`) vs `@TestPropertySource` across tests if desired.

## Open questions / risks
- Should tests rely solely on `@ActiveProfiles("test")` and profile files, or keep explicit `@TestPropertySource`?
- Some modules have no runtime resources; unclear if they should get profile files or stay configuration-free.

## Useful snippets (commands/configs/short excerpts)
- `mvn -pl pdf-inbound-api -Dtest=AuthControllerTest test`
- `mvn -pl pdf-inbound-api -Dtest=DocumentControllerTest,AuthControllerTest test`
- `pdf-inbound-api/src/main/resources/application.properties` (current runtime config)
- `pdf-inbound-api/src/test/resources/application-test.yml` (H2 + overrides; Testcontainers can override)
- `pdf-outbound-database/src/test/resources/application-test.properties` (JDBC Testcontainers)
